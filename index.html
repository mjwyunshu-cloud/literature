<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文学原型测试 | 灵魂手稿验证</title>
    <!-- 基础库 CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f2f0e9;
            color: #3a3833;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        .animate-fade-in { animation: fadeIn 1s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .handwritten-note {
            font-family: 'cursive', sans-serif;
            color: #d14d42;
            font-size: 0.75rem;
            transform: rotate(-3deg);
            display: inline-block;
        }
        
        .highlight-yellow {
            background: linear-gradient(180deg, rgba(255,255,255,0) 50%, #e8ed2a 50%);
            padding: 0 4px;
        }

        .redeem-input {
            background: transparent;
            border: none;
            border-bottom: 1.5px solid #3a3833;
            outline: none;
            text-align: center;
            letter-spacing: 0.2em;
            transition: all 0.3s;
        }
        .redeem-input:focus { border-bottom: 2px solid #35afcb; }
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 图标组件 - 内嵌SVG路径确保稳定性
        const Icon = ({ name, size = 24, className = "" }) => {
            const paths = {
                ChevronRight: "M9 18l6-6-6-6",
                RefreshCw: "M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15",
                Quote: "M3 21c3 0 7-1 7-8V5c0-1.25-.75-2-2-2H3c-1.25 0-2 .75-2 2v7c0 1.25.75 2 2 2 0 4-1 6-2 6zm11 0c3 0 7-1 7-8V5c0-1.25-.75-2-2-2h-5c-1.25 0-2 .75-2 2v7c0 1.25.75 2 2 2 0 4-1 6-2 6z",
                ArrowLeft: "M19 12H5M12 19l-7-7 7-7",
                ArrowRight: "M5 12h14M12 5l7 7-7 7",
                PenTool: "M12 19l7-7 3 3-7 7-3-3z M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z M2 2l5 5",
                ChevronDown: "M6 9l6 6 6-6",
                ChevronUp: "M18 15l-6-6-6 6",
                Star: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",
                Bookmark: "M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z",
                BookOpen: "M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z",
                Layers: "M12 2L2 7l10 5 10-5-10-5z M2 17l10 5 10-5 M2 12l10 5 10-5",
                Zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
                Download: "M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4 M7 10l5 5 5-5 M12 15V3",
                Fingerprint: "M12 11c0 3.517-1.009 6.799-2.753 9.571m-4.94-8.828A9 9 0 0118 9c0 1.258-.258 2.456-.725 3.546m-3.562 3.954A9 9 0 014 12"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={paths[name] || ""} />
                </svg>
            );
        };

        const COLORS = { bg: "#f2f0e9", textMain: "#3a3833", textSecondary: "#6d6b64", accentYellow: "#e8ed2a", accentBlue: "#35afcb", accentGreen: "#a4c29b", border: "#dcd8cf" };

        const ARCHETYPES = {
            REBEL: {
                name: "反叛者", sub: "超越秩序的火焰",
                identity: "骨子里燃烧着对平庸规则的生理性反感。",
                anxiety: "害怕被平庸的人群淹没，害怕自我的‘独特性’被体制稀释。",
                shadow: "过度追求破坏带来的快感，有时会由于缺乏支点而陷入虚无。",
                resonance: { mate: "流浪者", rival: "智者" },
                quote: "我要这天，再遮不住我眼；要这地，再埋不了我心。",
                quoteSource: "今何在《悟空传》",
                stats: [95, 40, 85, 45, 70],
                longDesc: "你的精神内核根植于对‘现成品’的生理性反感。你认为文学的本质不在于记录美，而在于摧毁虚伪的和平。你对应的创作冲动是‘图标破坏’。",
                books: [{ title: "《性的辩证法》", author: "舒拉姆斯·费尔斯通", desc: "以彻底的基进视角拆解社会结构。" }, { title: "《局外人》", author: "阿尔贝·加缪", desc: "用诚实抗击荒谬，完成精神反叛。" }]
            },
            SAGE: {
                name: "智者", sub: "洞察真理的慧眼",
                identity: "倾向于将世界视为一套由符号和因果编织而成的网络。",
                anxiety: "害怕逻辑的断裂，害怕面对那些无法被理性和知识解释的纯粹偶然。",
                shadow: "可能陷入极度的冷漠，将生命的美感简化为冰冷的解剖数据。",
                resonance: { mate: "悲剧英雄", rival: "理想主义者" },
                quote: "排除掉所有不可能，剩下的，不管多难以置信，都是真相。",
                quoteSource: "阿瑟·柯南·道尔《四签名》",
                stats: [35, 98, 30, 80, 55],
                longDesc: "你倾向于结构主义。你眼中的世界是一套由符号、权力和因果编织而成的网络。文学对你而言是手术刀。",
                books: [{ title: "《符号学原理》", author: "罗兰·巴特", desc: "掌握拆解文化背后含义的密钥。" }, { title: "《追寻逝去的时光》", author: "马塞尔·普鲁斯特", desc: "在时间迷宫中观察生命逻辑。" }]
            },
            IDEALIST: {
                name: "理想主义者", sub: "守望纯粹的诗意",
                identity: "坚信‘美即是真’，拒绝承认这个物质世界的唯一性。",
                anxiety: "由于过高的审美期待，常感到现实生活的异化与‘玷污’。",
                shadow: "脆弱的内心可能使其在残酷的冲突面前选择病态的自我放逐。",
                resonance: { mate: "流浪者", rival: "智者" },
                quote: "质本洁来还洁去，强于污淖陷渠沟。",
                quoteSource: "曹雪芹《红楼梦》",
                stats: [30, 55, 45, 45, 95],
                longDesc: "你对应着浪漫主义或唯美主义。你坚信‘美即是真’，文学是你逃离平庸日常、对抗异化的诺亚方舟。",
                books: [{ title: "《致狄奥提玛的诗》", author: "荷尔德林", desc: "寻找那份纯粹到近乎神圣的诗性理想。" }, { title: "《唯美主义》", author: "沃尔特·帕特", desc: "将生命本身作为一种艺术品来经营。" }]
            },
            WANDERER: {
                name: "流浪者", sub: "追逐风的自由灵魂",
                identity: "身份是在不断的试错与行走中被‘发明’出来的。",
                anxiety: "害怕任何形式的定居（包括精神上的），认为‘家园’即‘牢笼’。",
                shadow: "缺乏深度的情感联结，可能由于过度的自由而感到彻骨的寒冷。",
                resonance: { mate: "反叛者", rival: "悲剧英雄" },
                quote: "如果你给我的，和你给别人的是一样的，那我就不要了。",
                quoteSource: "三毛《撒哈拉的故事》",
                stats: [60, 45, 75, 98, 40],
                longDesc: "你对应着存在主义。你认为‘存在先于本质’，身份是在不断的行走中被创造的。文学对你而言是通向异乡的地图。",
                books: [{ title: "《在路上》", author: "杰克·凯鲁亚克", desc: "对灵魂自由最赤裸的呼唤。" }, { title: "《流浪者之歌》", author: "赫尔曼·黑塞", desc: "一场关于寻找自我的终极修行。" }]
            },
            HERO: {
                name: "悲剧英雄", sub: "宿命中的尊严抗争",
                identity: "在明知结局会‘陨落’的前提下，选择挺身而出完成使命。",
                anxiety: "害怕勇气的枯竭，害怕在那场必败的战争中显露出哪怕一秒的怯懦。",
                shadow: "容易被壮烈的自我崇高感所绑架，从而忽视了平凡生活的真实价值。",
                resonance: { mate: "智者", rival: "流浪者" },
                quote: "生存还是毁灭，这是一个值得考虑的问题。",
                quoteSource: "莎士比亚《哈姆雷特》",
                stats: [80, 65, 55, 50, 90],
                longDesc: "你深受古典悲剧美学影响。你理解世界的残酷与荒谬，但你选择在必然的‘毁灭’中确立人的主体性。",
                books: [{ title: "《西绪福斯神话》", author: "阿尔贝·加缪", desc: "如何推着巨石却依然称自己幸福。" }, { title: "《悲剧的诞生》", author: "尼采", desc: "理解自我毁灭中那股强韧生命冲动。" }]
            }
        };

        const QUESTIONS = [
            { id: 1, text: "深夜，你发现笔下的主角正试图逃出书页。你的第一反应是：", options: [{ text: "帮他推开封底的门，去往没有定义的旷野", type: "WANDERER" }, { text: "重新拿起笔，为他画上一道必死的壮烈关口", type: "HERO" }, { text: "冷眼分析他逃跑的路径，看看逻辑在哪出了漏洞", type: "SAGE" }, { text: "将书页浸入月光，在墨色幻梦里获得永恒", type: "IDEALIST" }]},
            { id: 2, text: "你在迷雾森林发现一间没有锁的图书馆，里面只有一种书：", options: [{ text: "记录所有神灵陨落时刻的血色史书", type: "REBEL" }, { text: "将万物拆解成符号索引的理性系统", type: "SAGE" }, { text: "辞藻华丽到让人窒息的残诗", type: "IDEALIST" }, { text: "每一页都通向不同异乡的游记", type: "WANDERER" }]},
            { id: 3, text: "一个老巫师要你用“一半灵魂”交换文字的魔力。你的回击是：", options: [{ text: "烧了他的扫帚：自由的文字不需要肮脏的契约", type: "REBEL" }, { text: "用剩下的灵魂，写一首祭奠牺牲的悲歌", type: "IDEALIST" }, { text: "询问他能量守恒公式，试图反向操控他", type: "SAGE" }, { text: "“我早已将灵魂挥洒在路上，他来晚了”", type: "WANDERER" }]},
            { id: 4, text: "如果你不幸被囚禁在哥特式地牢，你会在墙上刻下：", options: [{ text: "一串隐晦的坐标，指引后人找到真相", type: "SAGE" }, { text: "一句对这暴虐王权的永恒诅咒", type: "REBEL" }, { text: "一多正在凋零的玫瑰，守护最后的美学", type: "IDEALIST" }, { text: "“此地不留行”，记录曾在此驻足的痕迹", type: "WANDERER" }]},
            { id: 5, text: "在一场虚构的酒会上，死神向你敬酒。你会：", options: [{ text: "与他碰杯，谈论戏剧终结时的美学价值", type: "SAGE" }, { text: "泼在他脸上：落幕由我说了算", type: "REBEL" }, { text: "喝下苦酒，为没来得及绽放的角色流一滴泪", type: "IDEALIST" }, { text: "翻窗离去，死亡也不过是另一场漂泊", type: "WANDERER" }]},
            { id: 6, text: "你发现一个完美的角色其实是提线木偶。你选择：", options: [{ text: "剪断所有的线，让他获得一秒的自由", type: "REBEL" }, { text: "通过他去观察背后那双操纵一切的手", type: "SAGE" }, { text: "用丝绸装饰他，让他成为最精美的艺术品", type: "IDEALIST" }, { text: "离开剧场，你更喜欢旷野里的真实野狗", type: "WANDERER" }]},
            { id: 7, text: "文字如果有温度，你希望你的叙事是：", options: [{ text: "绝对的零度：冷峻、透彻，冻结虚假感伤", type: "SAGE" }, { text: "灼烧的岩浆：愤怒、原始，烧毁所有屏障", type: "REBEL" }, { text: "恒温的晚霞：柔和、忧郁，在光影中守望", type: "IDEALIST" }, { text: "自由的风温：随季节迁徙，从不停留", type: "WANDERER" }]},
            { id: 8, text: "你在文本深处遇到“预知镜”，镜子里是你的死期：", options: [{ text: "记下精确时间，完成最有逻辑的收尾", type: "SAGE" }, { text: "打碎镜子：即便宿命已定，也要在碎裂中起舞", type: "HERO" }, { text: "在镜面画满花朵，用谎言覆盖冷酷真实", type: "IDEALIST" }, { text: "背对镜子继续前行：终点在哪里，我不在乎", type: "WANDERER" }]},
            { id: 9, text: "文学里的“风景”对你而言，最好的状态是：", options: [{ text: "荆棘荒原，试炼英雄骨骼的战道", type: "HERO" }, { text: "充满数学隐喻的森林，每个细节藏着线索", type: "SAGE" }, { text: "半梦半醒间的江南烟雨，灵魂的避难所", type: "IDEALIST" }, { text: "没有边际的海，呼唤着流浪的帆", type: "WANDERER" }]},
            { id: 10, text: "如果生活是文学的影子，最根本的矛盾在于：", options: [{ text: "权力系统与觉醒反抗意志之间的博弈", type: "REBEL" }, { text: "混乱现象与必然因果逻辑之间的拉锯", type: "SAGE" }, { text: "平庸生存与高远审美理想之间的鸿沟", type: "IDEALIST" }, { text: "自由选择与冷酷客观环境之间的冲突", type: "WANDERER" }]},
            { id: 11, text: "遇到一个完美的“精神家园”：", options: [{ text: "“真正的灵魂应当永远在路上”", type: "WANDERER" }, { text: "“它是我创作一直守望的归宿”", type: "IDEALIST" }, { text: "“分析它的构成逻辑，试图复刻”", type: "SAGE" }, { text: "“家园是温床也是坟墓，我必须摧毁它”", type: "REBEL" }]},
            { id: 12, text: "叙事中出现了长久的“沉默”：", options: [{ text: "像加密电报，等待理性的解码", type: "SAGE" }, { text: "英雄最后的慷慨悲歌", type: "HERO" }, { text: "为了更猛烈的反叛", type: "REBEL" }, { text: "语言无法承载的纯粹感性", type: "IDEALIST" }]},
            { id: 13, text: "对手是你亲手创造的角色：", options: [{ text: "拥有比我更坚定的反抗精神", type: "REBEL" }, { text: "在逻辑巅峰与我博弈", type: "SAGE" }, { text: "替我完成纯洁的救赎", type: "IDEALIST" }, { text: "映照出人的主体性尊严", type: "HERO" }]},
            { id: 14, text: "镜子里“照见真实”：", options: [{ text: "精密的因果网络", type: "SAGE" }, { text: "拒绝下跪的英雄剪影", type: "HERO" }, { text: "空无一物，只有远方的风", type: "WANDERER" }, { text: "折射出我不愿展示的梦", type: "IDEALIST" }]},
            { id: 15, text: "面对“传统文化”，主角选：", options: [{ text: "背负它在沉重行走中守望", type: "HERO" }, { text: "将腐朽符号转化为叙事砖石", type: "SAGE" }, { text: "烧毁它，废墟才是自由的操场", type: "REBEL" }, { text: "词藻中重构从未存在的盛世", type: "IDEALIST" }]},
            { id: 16, text: "“胜利”的一刻，感到：", options: [{ text: "洞察背后荒谬的虚无", type: "WANDERER" }, { text: "惨烈牺牲带来的神圣悲情", type: "HERO" }, { text: "复仇色彩的快慰", type: "REBEL" }, { text: "达成智性闭环的平静", type: "SAGE" }]},
            { id: 17, text: "关于“叙述者”的语气：", options: [{ text: "上帝一样冷静记录", type: "SAGE" }, { text: "文字里流淌血与泪的参与", type: "HERO" }, { text: "游走在现实与幻觉边缘的梦游", type: "IDEALIST" }, { text: "时刻准备冒犯读者的闯入", type: "REBEL" }]},
            { id: 18, text: "你如何处理文学中的“自然”？", options: [{ text: "灵魂唯一能安宁的神圣圣地", type: "IDEALIST" }, { text: "路边的野花比图书馆亲切", type: "WANDERER" }, { text: "试炼英雄骨骼的磨刀石", type: "HERO" }, { text: "可被捕捉的资源池", type: "SAGE" }]},
            { id: 19, text: "对于“神秘主义”的态度：", options: [{ text: "审美的温床，解释清楚了美就凋谢了", type: "IDEALIST" }, { text: "总有一天迷雾会被穿透", type: "SAGE" }, { text: "我们要用反叛逼出真相", type: "REBEL" }, { text: "永远在追逐，但从未抵达", type: "WANDERER" }]},
            { id: 20, text: "如果世界将在五分钟后毁灭：", options: [{ text: "喝最后一口苦咖啡看夕阳", type: "WANDERER" }, { text: "紧抱不完美的自己谢幕", type: "HERO" }, { text: "记录数据，作为文明存证", type: "SAGE" }, { text: "嘲讽这荒唐的世界终剧", type: "REBEL" }]},
            { id: 21, text: "叙事黑洞正在吞噬结局：", options: [{ text: "记录引力对逻辑的扭曲率", type: "SAGE" }, { text: "对着虚无发出最后狂笑", type: "REBEL" }, { text: "看看另一端是否自由", type: "WANDERER" }, { text: "华丽修饰这场崩塌", type: "IDEALIST" }]},
            { id: 22, text: "发现一朵不凋零的“塑料花”：", options: [{ text: "思考它如何欺骗感官", type: "SAGE" }, { text: "愤怒于廉价，将其埋葬", type: "REBEL" }, { text: "作为对失落文明的怀旧", type: "IDEALIST" }, { text: "假的东西即便永恒也无重量", type: "WANDERER" }]},
            { id: 23, text: "如果文字有气味，那是：", options: [{ text: "福尔马林：冷静解剖质感", type: "SAGE" }, { text: "火药与灰烬：带有破坏秩序后的余温", type: "REBEL" }, { text: "旧报纸与丁香：诗意的忧郁", type: "IDEALIST" }, { text: "咸涩的海风：孤独野性", type: "WANDERER" }]},
            { id: 24, text: "页边距里的“微型国家”：", options: [{ text: "非法寄生，应被逻辑肃清", type: "REBEL" }, { text: "抗衡宏大叙事的堡垒", type: "HERO" }, { text: "体现了语言的不稳定性", type: "SAGE" }, { text: "在这里我不再是被叙述的人", type: "IDEALIST" }]},
            { id: 25, text: "如果时间是纸张，你会涂抹：", options: [{ text: "向后连接编织的逻辑网", type: "SAGE" }, { text: "记录对抗衰老的疤痕", type: "HERO" }, { text: "漫无目的飘向空白", type: "WANDERER" }, { text: "半透明彩墨，虚幻厚度", type: "IDEALIST" }]},
            { id: 26, text: "文字最终的形态应当是：", options: [{ text: "点燃读者也毁灭自己的火炬", type: "REBEL" }, { text: "完美的智性圆环", type: "SAGE" }, { text: "延伸至地平线的模糊直线", type: "WANDERER" }, { text: "散落在虚空的羽毛", type: "IDEALIST" }]},
            { id: 27, text: "主角面对神灵的沉默：", options: [{ text: "发起必败的挑战", type: "HERO" }, { text: "意识到神灵是伪命题", type: "SAGE" }, { text: "转身走入沙漠流浪", type: "WANDERER" }, { text: "创造自己的神圣瞬间", type: "IDEALIST" }]},
            { id: 28, text: "世界坍塌，剩下一个词：", options: [{ text: "“但是”，代表反抗可能", type: "REBEL" }, { text: "“因为”，守住因果底线", type: "SAGE" }, { text: "“也许”，保留审美余地", type: "IDEALIST" }, { text: "“再会”，预示下一场启程", type: "WANDERER" }]},
            { id: 29, text: "为历史写注脚，你选：", options: [{ text: "揭穿华丽词藻下的权力", type: "REBEL" }, { text: "总结文明演变公理", type: "SAGE" }, { text: "为被遗忘个体写葬歌", type: "IDEALIST" }, { text: "旷野还有自由", type: "WANDERER" }]},
            { id: 30, text: "你的灵魂是一件圣器：", options: [{ text: "剖开伪善的利刃", type: "REBEL" }, { text: "观测轨迹的望远镜", type: "SAGE" }, { text: "装下晚霞的墨水瓶", type: "IDEALIST" }, { text: "折叠不完的地图", type: "WANDERER" }]}
        ];

        // 重新定义首页核心插画
        const JarIllustration = () => (
            <svg viewBox="0 0 400 350" className="w-full h-full drop-shadow-sm">
                <path d="M150 100 L250 100 L265 135 Q 310 160 310 250 Q 310 310 200 310 Q 90 310 90 250 Q 90 160 135 135 Z" fill="none" stroke={COLORS.textMain} strokeWidth="1.5" />
                <path d="M160 110 L240 110" stroke={COLORS.textMain} strokeWidth="1" />
                <g transform="translate(180, 210)">
                    <circle cx="20" cy="20" r="8" fill="none" stroke={COLORS.textMain} strokeWidth="1.2" />
                    <path d="M20 28 Q 20 55 10 75 M20 28 Q 20 55 30 75" fill="none" stroke={COLORS.textMain} strokeWidth="1.2" />
                    <path d="M12 45 Q 20 40 28 45" fill="none" stroke={COLORS.textMain} strokeWidth="1.2" />
                </g>
                <circle cx="330" cy="110" r="4" fill={COLORS.textMain} />
                <circle cx="350" cy="140" r="2" fill={COLORS.textMain} />
                <path d="M265 135 Q 360 70 390 110" stroke={COLORS.textMain} strokeWidth="0.6" strokeDasharray="5 3" />
                <g transform="translate(35, 45) rotate(-6)">
                    <rect x="0" y="0" width="85" height="32" rx="4" fill="white" stroke={COLORS.border} strokeWidth="1" />
                    <text x="42" y="21" textAnchor="middle" fontSize="9" fill={COLORS.textSecondary} style={{fontWeight: 'bold'}}>存稿编号：零壹</text>
                </g>
                <g transform="translate(285, 275) rotate(12)">
                    <path d="M0 20 Q 25 -5 55 20" fill="none" stroke={COLORS.accentBlue} strokeWidth="1.8" />
                    <text x="0" y="48" fontSize="8.5" fill={COLORS.accentBlue} style={{fontWeight: 'bold'}}>文学主体性存证 →</text>
                </g>
                <circle cx="350" cy="55" r="28" fill={COLORS.accentYellow} opacity="0.35" />
                <rect x="45" y="245" width="45" height="45" rx="22" fill={COLORS.accentGreen} opacity="0.25" />
            </svg>
        );

        function App() {
            const [step, setStep] = useState('welcome');
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [scores, setScores] = useState({ REBEL: 0, SAGE: 0, IDEALIST: 0, WANDERER: 0, HERO: 0 });
            const [history, setHistory] = useState([]);
            const [result, setResult] = useState(null);
            const [isSaving, setIsSaving] = useState(false);
            const [code, setCode] = useState("");
            const [showError, setShowError] = useState(false);

            const radarCanvas = useRef(null);
            const captureRef = useRef(null);
            const chartRef = useRef(null);

            const handleVerify = () => { if (code.toLowerCase() === "cloud") setStep('quiz'); else { setShowError(true); setTimeout(() => setShowError(false), 500); } };
            const handleAnswer = (type) => {
                const newScores = { ...scores, [type]: scores[type] + 1 };
                setHistory([...history, { scores, currentQuestion }]);
                setScores(newScores);
                if (currentQuestion < 29) setCurrentQuestion(currentQuestion + 1);
                else {
                    const top = Object.keys(newScores).reduce((a, b) => newScores[a] > newScores[b] ? a : b);
                    setResult(ARCHETYPES[top]);
                    setStep('result');
                    window.scrollTo(0, 0);
                }
            };
            const handleBack = () => { if (history.length > 0) { const last = history.pop(); setScores(last.scores); setCurrentQuestion(last.currentQuestion); setHistory([...history]); } else setStep('welcome'); };
            const handleRestart = () => { setStep('welcome'); setCurrentQuestion(0); setScores({ REBEL: 0, SAGE: 0, IDEALIST: 0, WANDERER: 0, HERO: 0 }); setHistory([]); setResult(null); setCode(""); window.scrollTo(0, 0); };

            const saveAsImage = async () => {
                setIsSaving(true);
                try {
                    const canvas = await html2canvas(captureRef.current, { scale: 2, backgroundColor: COLORS.bg, useCORS: true });
                    const link = document.createElement('a');
                    link.download = `文学报告-${result.name}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) { console.error(err); }
                setIsSaving(false);
            };

            useEffect(() => {
                if (step === 'result' && result && radarCanvas.current) {
                    if (chartRef.current) chartRef.current.destroy();
                    chartRef.current = new Chart(radarCanvas.current.getContext('2d'), {
                        type: 'radar',
                        data: {
                            labels: ['反叛', '智性', '审美', '自由', '英雄性'],
                            datasets: [{ data: result.stats, backgroundColor: 'rgba(53, 175, 203, 0.1)', borderColor: COLORS.accentBlue, borderWidth: 1, pointRadius: 0 }]
                        },
                        options: { scales: { r: { angleLines: { display: false }, grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { display: false }, min: 0, max: 100 } }, plugins: { legend: { display: false } } }
                    });
                }
            }, [step, result]);

            return (
                <div className="max-w-xl mx-auto px-4 py-8">
                    {step === 'welcome' && (
                        <div className="animate-fade-in text-center space-y-12">
                            <div className="text-left pt-6">
                                <div className="inline-block px-3 py-1 bg-[#35afcb] text-white text-[9px] tracking-widest mb-4 transform -rotate-2">Psychographic Assessment</div>
                                <h1 className="text-4xl md:text-5xl font-light leading-tight tracking-widest text-[#3a3833]">寻找你的<br /><span className="font-bold border-b-4 border-[#e8ed2a]">文学原型</span></h1>
                            </div>
                            <div className="w-full max-w-[340px] mx-auto aspect-[4/3.5] relative">
                                <JarIllustration />
                                <div className="absolute top-[20%] right-[-10px] bg-white px-3 py-2 rounded-2xl shadow-sm border border-[#dcd8cf] transform rotate-3 max-w-[120px]">
                                    <p className="text-[10px] text-[#6d6b64] leading-tight italic">“在叙事中，<br/>发明你自己”</p>
                                </div>
                            </div>
                            <div className="space-y-10">
                                <p className="text-xs text-[#6d6b64] leading-relaxed tracking-wider px-6 font-light">基于 30 组跨越时空的文学幻境，勾勒灵魂深处的回响。</p>
                                <div className={`space-y-4 ${showError ? 'shake' : ''}`}>
                                    <div className="flex flex-col items-center gap-2">
                                        <span className="text-[10px] uppercase tracking-[0.3em] opacity-40">文学通行码认证</span>
                                        <input type="text" value={code} onChange={(e) => setCode(e.target.value)} className="redeem-input w-48 py-2 text-sm" placeholder="请在此输入码" />
                                        {showError && <span className="text-[9px] text-red-400">认证失败，请核对。</span>}
                                    </div>
                                </div>
                                <button onClick={handleVerify} className="w-full py-6 bg-[#3a3833] text-white text-[11px] tracking-[0.8em] font-bold flex items-center justify-center gap-4 active:scale-95 transition-all">开启漫游 / LAUNCH <Icon name="ArrowRight" size={16} className="text-[#e8ed2a]" /></button>
                                <div className="text-[10px] text-gray-400 tracking-[0.3em]">Curated by @云树cloudtree</div>
                            </div>
                        </div>
                    )}

                    {step === 'quiz' && (
                        <div className="animate-fade-in space-y-8 text-center">
                            <div className="flex justify-between items-center border-b border-[#dcd8cf] pb-4">
                                <button onClick={handleBack} className="flex items-center gap-1 text-[10px] uppercase opacity-40 hover:opacity-100 transition-all"><Icon name="ArrowLeft" size={14} /> BACK</button>
                                <span className="text-[9px] uppercase text-[#6d6b64] font-bold">Step {String(currentQuestion + 1).padStart(2, '0')} / 30</span>
                                <div className="w-10"></div>
                            </div>
                            <h2 className="text-xl md:text-2xl leading-relaxed min-h-[140px] flex items-center justify-center italic px-4">{QUESTIONS[currentQuestion].text}</h2>
                            <div className="space-y-4 text-left">
                                {QUESTIONS[currentQuestion].options.map((option, idx) => (
                                    <button key={idx} onClick={() => handleAnswer(option.type)} className="w-full p-6 bg-white bg-opacity-70 rounded-[12px] border border-[#dcd8cf] hover:border-[#3a3833] transition-all group flex items-center justify-between text-left">
                                        <span className="text-[14px] text-[#6d6b64] group-hover:text-[#3a3833] leading-relaxed pr-4">{option.text}</span>
                                        <Icon name="ChevronRight" size={14} className="opacity-0 group-hover:opacity-100 transition-all text-[#35afcb]" />
                                    </button>
                                ))}
                            </div>
                            <div className="pt-10 flex justify-center"><div className="h-[1px] w-48 bg-[#dcd8cf] relative"><div className="h-full bg-[#3a3833] transition-all duration-700" style={{width: `${((currentQuestion+1)/30)*100}%`}}></div></div></div>
                        </div>
                    )}

                    {step === 'result' && result && (
                        <div className="animate-fade-in space-y-8 pb-12">
                            <div ref={captureRef} className="p-4 space-y-12 bg-[#f2f0e9]">
                                <div className="text-center space-y-6 py-12 bg-white border border-[#dcd8cf] rounded-sm shadow-sm relative overflow-hidden">
                                    <div className="absolute top-4 left-4"><Icon name="Fingerprint" size={32} className="opacity-10" /></div>
                                    <span className="text-[10px] font-bold uppercase tracking-[0.5em] text-[#35afcb]">Literature Archetype Profile</span>
                                    <h2 className="text-6xl font-bold text-[#3a3833] tracking-widest">{result.name}</h2>
                                    <p className="text-sm text-[#35afcb] italic tracking-[0.4em]">{result.sub}</p>
                                    <div className="flex justify-center gap-4 pt-4">
                                        <span className="px-3 py-1 border border-[#3a3833] text-[9px] font-bold uppercase">思辨觉醒度 98%</span>
                                        <span className="px-3 py-1 bg-[#3a3833] text-white text-[9px] font-bold uppercase">主体性存证</span>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center bg-white p-8 border border-[#dcd8cf] relative">
                                    <div className="absolute -top-3 -right-3 px-3 py-1 bg-white border border-[#3a3833] text-[10px] font-bold transform rotate-3">NO. 2026-Soul</div>
                                    <div className="space-y-4">
                                        <h4 className="text-[11px] font-bold border-b pb-2">叙事基因分析报告</h4>
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center text-[10px]"><span>感性驱动</span><div className="w-24 h-1 bg-gray-100"><div className="h-full bg-[#e8ed2a]" style={{width:'85%'}}></div></div></div>
                                            <div className="flex justify-between items-center text-[10px]"><span>理性逻辑</span><div className="w-24 h-1 bg-gray-100"><div className="h-full bg-[#35afcb]" style={{width:'40%'}}></div></div></div>
                                            <div className="flex justify-between items-center text-[10px]"><span>反叛意志</span><div className="w-24 h-1 bg-gray-100"><div className="h-full bg-black" style={{width:'70%'}}></div></div></div>
                                        </div>
                                        <div className="handwritten-note mt-4">* 核心观察：存在强烈的审美自觉</div>
                                    </div>
                                    <div className="aspect-square w-full max-w-[200px] mx-auto">
                                        <canvas ref={radarCanvas}></canvas>
                                    </div>
                                </div>

                                <div className="relative p-12 bg-white border border-[#dcd8cf] text-center shadow-sm">
                                    <Icon name="Quote" size={32} className="text-[#35afcb] mb-6 opacity-20 mx-auto" />
                                    <p className="text-xl leading-relaxed mb-6 font-medium">
                                        <span className="highlight-yellow">{result.quote}</span>
                                    </p>
                                    <div className="text-[10px] text-[#a4c29b] tracking-widest uppercase font-bold">— {result.quoteSource} —</div>
                                </div>

                                <div className="space-y-10 px-2">
                                    <section className="space-y-4">
                                        <h4 className="text-[11px] font-bold uppercase tracking-[0.5em] flex items-center gap-3 border-b border-[#dcd8cf] pb-2">
                                            <Icon name="Layers" size={14} className="text-[#35afcb]" /> 灵魂本色 / THE SELF
                                        </h4>
                                        <div className="bg-white p-6 border-l-4 border-[#35afcb] space-y-4 text-left">
                                            <p className="text-[13px] leading-relaxed text-[#6d6b64] italic">“{result.identity}”</p>
                                            <p className="text-[13px] leading-relaxed font-light">{result.longDesc}</p>
                                        </div>
                                    </section>
                                    <section className="space-y-4 text-left">
                                        <h4 className="text-[11px] font-bold uppercase tracking-[0.5em] flex items-center gap-3 border-b border-[#dcd8cf] pb-2 text-red-800">
                                            <Icon name="Zap" size={14} className="text-red-600" /> 核心焦虑与盲区
                                        </h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-[12px]">
                                            <div className="p-4 bg-red-50 border border-red-100 rounded">
                                                <div className="font-bold mb-1">主导焦虑</div>
                                                <div className="opacity-70">{result.anxiety}</div>
                                            </div>
                                            <div className="p-4 bg-gray-50 border border-gray-100 rounded">
                                                <div className="font-bold mb-1">阴影面</div>
                                                <div className="opacity-70">{result.shadow}</div>
                                            </div>
                                        </div>
                                    </section>
                                    <section className="space-y-6 text-left">
                                        <h4 className="text-[11px] font-bold uppercase tracking-[0.5em] flex items-center gap-3 border-b border-[#dcd8cf] pb-2">
                                            <Icon name="Star" size={14} className="text-[#e8ed2a]" /> 进阶书单推荐
                                        </h4>
                                        <div className="grid gap-4">
                                            {result.books.map((book, i) => (
                                                <div key={i} className="bg-white p-6 border border-[#dcd8cf] relative group">
                                                    <div className="absolute top-0 right-0 p-2 opacity-5"><Icon name="Bookmark" size={20} /></div>
                                                    <h5 className="text-[15px] font-bold mb-1">{book.title}</h5>
                                                    <p className="text-[10px] text-[#a4c29b] font-bold mb-2">作者: {book.author}</p>
                                                    <p className="text-xs text-[#6d6b64] italic leading-relaxed opacity-80">{book.desc}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                </div>
                            </div>

                            <div className="pt-8 space-y-4 text-center px-4">
                                <button onClick={saveAsImage} disabled={isSaving} className="w-full py-5 bg-black text-white text-[11px] font-bold uppercase tracking-[0.5em] flex items-center justify-center gap-3 shadow-xl active:bg-gray-800 disabled:opacity-50">
                                    {isSaving ? "生成中..." : <><Icon name="Download" size={16} /> 保存手稿报告 / SAVE REPORT</>}
                                </button>
                                <button onClick={handleRestart} className="w-full py-5 border border-[#3a3833] text-[11px] font-bold uppercase tracking-[0.5em] hover:bg-[#3a3833] hover:text-white transition-all">
                                    <Icon name="RefreshCw" size={14} className="inline mr-2" /> 再次重塑原型
                                </button>
                            </div>
                        </div>
                    )}
                    <footer className="mt-16 pt-16 border-t border-[#dcd8cf] text-center space-y-4">
                        <p className="text-[10px] tracking-[0.6em] uppercase text-[#3a3833] font-bold opacity-60">© 2026 CURATED BY @云树CLOUDTREE</p>
                        <p className="text-[9px] tracking-[0.3em] uppercase text-[#6d6b64] opacity-30 italic">为精神生长提供坐标 / Mapping Mental Growth</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
